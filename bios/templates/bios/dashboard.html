
{% extends "bios/base.html" %}
{% load static %}

{% block content %}

{% comment %} Welcome to Talent Statistics Dashboard!!! {% endcomment %}

<nav class="col-md-3">
    <div>
        {% comment %} <hr class="mb-4"> {% endcomment %}
        <form action="/talent_dashboard/" method="get">
            <div class="row">
                <div class="mb-3">
                    <label for="skill">  Skill </label>
                    <select id="skill" class="custom-select d-block w-100" name="skill-dropdown">
                        <option value="">Choose...</option>
                        {% for p in skill_distinct %}
                            <option value="{{ p }}" {%if p in skill_query %} selected {%endif%}> {{ p }} </option>
                        {% endfor %}

                    </select>
                    {% comment %} {% endcomment %}
                </div>
            </div>
            <hr class="mb-4">
            <div class="row">
                <div class = "mb-3">
                    <label for="industry"> Industry Experience</label>
                    <select class="custom-select d-block w-100" name="industry-dropdown">
                        <option value="">Choose...</option>
                        {% for p in industry_distinct %}
                        <option value="{{ p }}" {%if p in industry_query %} selected {%endif%}> {{ p }} </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <hr class="mb-4">
            <div class="row">
                <div class = "mb-3">
                    <label for="tech"> Technique Skill </label>
                    <select class="custom-select d-block w-100" name="tech-dropdown">
                        <option value="">Choose...</option>
                        {% for p in tech_distinct %}
                        <option value="{{ p }}" {%if p in technique_query %} selected {%endif%}> {{ p }} </option>
                        {% endfor %}
                    </select>
                </div>
            </div>
            <hr class="mb-4">
            <div class="row">
                <div class="mb-3">
                    <label for="domain"> Business Domain </label>
                    <select class="custom-select d-block w-100" name="domain-dropdown">
                        <option value="">Choose...</option>
                        {% for p in domain_distinct %}
                        <option value="{{ p }}" {%if p in domain_query %} selected {%endif%}> {{ p }} </option>
                        {% endfor %}
                    </select>
                </div>
            </div>


            <button class="btn btn-primary btn-lg btn-block" type="submit" value="Apply">
                Apply
            </button>
        </form>
    </div>
</nav>

<div id="container" style="width: 60%; margin:auto;">
    {% comment %} <canvas id="pie-chart"></canvas> {% endcomment %}
    <canvas id="bar-chart"></canvas>
</div>

{% endblock %}

{%block jsblock%}
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script type="text/javascript">
    if ({{filter_count}} == 2){
        var data = {{data}}
        function decodeEntity(inputStr) {
            var textarea = document.createElement("textarea");
            textarea.innerHTML = inputStr;
            return textarea.value;
        }
        var color = "{{sns_color}}";
        color = decodeEntity(color);
        console.log(color);

        var config = {
            type:'horizontalBar',
            data: {
                labels:['Unfamiliar', 'Novice', 'Proficient', 'Advanced', 'Expert'],
                datasets: [{
                    label: '<1 Year',
                    data: data.map(d => d[0]),
                    backgroundColor : '#66c2a5',
                }, {
                    label: '1-3 Year',
                    data: data.map(d => d[1]),
                    backgroundColor : '#fc8d62',
                }, {
                    label: '4-5 Year',
                    data: data.map(d => d[2]),
                    backgroundColor : '#8da0cb',
                }, {
                    label: '5-10 Year',
                    data: data.map(d => d[3]),
                    backgroundColor : '#e78ac3',
                }, {
                    label: '>10 Year',
                    data: data.map(d => d[4]),
                    backgroundColor : '#e5c494',
                }]
            },
            options: {
                responsive: true,
                scales: {
                    yAxes: [{
                        ticks: { beginAtZero: true },
                        stacked: true,
                    }],
                    xAxes: [{
                        stacked: true,
                    }],
                },
            }
        }

        window.onload = function() {
            var ctx = document.getElementById('bar-chart').getContext('2d');
            window.myBar = new Chart(ctx, config);
        };
    }
    else {
        var config = {
            type: 'bar',
            data: {
              datasets: [{
                data: {{ single_data|safe }},
                backgroundColor : [
                        '#66c2a5', '#fc8d62', '#8da0cb', '#e78ac3', '#a6d854', 
                        '#ffd92f', '#e5c494', '#b3b3b3'
                        ],
                label: 'hahaha',
              }],
              labels: {{ labels|safe }}
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true
                        }
                    }]
                },
                responsive: true
            }
          };
          window.onload = function() {
            var ctx = document.getElementById('bar-chart').getContext('2d');
            window.myBar = new Chart(ctx, config);
        };
    }
     

</script>
{%endblock jsblock%}

